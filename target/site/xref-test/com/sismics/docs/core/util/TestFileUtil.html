<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>TestFileUtil xref</title>
<link type="text/css" rel="stylesheet" href="../../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../../testapidocs/com/sismics/docs/core/util/TestFileUtil.html">View Javadoc</a></div><pre>
<a class="jxr_linenumber" name="L1" href="#L1">1</a>   <strong class="jxr_keyword">package</strong> com.sismics.docs.core.util;
<a class="jxr_linenumber" name="L2" href="#L2">2</a>   
<a class="jxr_linenumber" name="L3" href="#L3">3</a>   <strong class="jxr_keyword">import</strong> com.google.common.collect.Lists;
<a class="jxr_linenumber" name="L4" href="#L4">4</a>   <strong class="jxr_keyword">import</strong> com.google.common.io.Resources;
<a class="jxr_linenumber" name="L5" href="#L5">5</a>   <strong class="jxr_keyword">import</strong> com.sismics.BaseTest;
<a class="jxr_linenumber" name="L6" href="#L6">6</a>   <strong class="jxr_keyword">import</strong> com.sismics.docs.core.dao.dto.DocumentDto;
<a class="jxr_linenumber" name="L7" href="#L7">7</a>   <strong class="jxr_keyword">import</strong> com.sismics.docs.core.model.jpa.File;
<a class="jxr_linenumber" name="L8" href="#L8">8</a>   <strong class="jxr_keyword">import</strong> com.sismics.docs.core.util.format.*;
<a class="jxr_linenumber" name="L9" href="#L9">9</a>   <strong class="jxr_keyword">import</strong> com.sismics.util.mime.MimeType;
<a class="jxr_linenumber" name="L10" href="#L10">10</a>  <strong class="jxr_keyword">import</strong> com.sismics.util.mime.MimeTypeUtil;
<a class="jxr_linenumber" name="L11" href="#L11">11</a>  <strong class="jxr_keyword">import</strong> org.junit.Assert;
<a class="jxr_linenumber" name="L12" href="#L12">12</a>  <strong class="jxr_keyword">import</strong> org.junit.Test;
<a class="jxr_linenumber" name="L13" href="#L13">13</a>  
<a class="jxr_linenumber" name="L14" href="#L14">14</a>  <strong class="jxr_keyword">import</strong> java.io.ByteArrayOutputStream;
<a class="jxr_linenumber" name="L15" href="#L15">15</a>  <strong class="jxr_keyword">import</strong> java.io.InputStream;
<a class="jxr_linenumber" name="L16" href="#L16">16</a>  <strong class="jxr_keyword">import</strong> java.nio.file.Files;
<a class="jxr_linenumber" name="L17" href="#L17">17</a>  <strong class="jxr_keyword">import</strong> java.nio.file.Path;
<a class="jxr_linenumber" name="L18" href="#L18">18</a>  <strong class="jxr_keyword">import</strong> java.nio.file.Paths;
<a class="jxr_linenumber" name="L19" href="#L19">19</a>  <strong class="jxr_keyword">import</strong> java.nio.file.StandardCopyOption;
<a class="jxr_linenumber" name="L20" href="#L20">20</a>  <strong class="jxr_keyword">import</strong> java.util.Date;
<a class="jxr_linenumber" name="L21" href="#L21">21</a>  
<a class="jxr_linenumber" name="L22" href="#L22">22</a>  <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L23" href="#L23">23</a>  <em class="jxr_javadoccomment"> * Test of the file utilities.</em>
<a class="jxr_linenumber" name="L24" href="#L24">24</a>  <em class="jxr_javadoccomment"> * </em>
<a class="jxr_linenumber" name="L25" href="#L25">25</a>  <em class="jxr_javadoccomment"> * @author bgamard</em>
<a class="jxr_linenumber" name="L26" href="#L26">26</a>  <em class="jxr_javadoccomment"> */</em>
<a class="jxr_linenumber" name="L27" href="#L27">27</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">class</strong> <a name="TestFileUtil" href="../../../../../com/sismics/docs/core/util/TestFileUtil.html#TestFileUtil">TestFileUtil</a> <strong class="jxr_keyword">extends</strong> <a name="BaseTest" href="../../../../../com/sismics/BaseTest.html#BaseTest">BaseTest</a> {
<a class="jxr_linenumber" name="L28" href="#L28">28</a>      @Test
<a class="jxr_linenumber" name="L29" href="#L29">29</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> extractContentOpenDocumentTextTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L30" href="#L30">30</a>          Path path = Paths.get(getResource(FILE_ODT).toURI());
<a class="jxr_linenumber" name="L31" href="#L31">31</a>          FormatHandler formatHandler = FormatHandlerUtil.find(MimeTypeUtil.guessMimeType(path, FILE_ODT));
<a class="jxr_linenumber" name="L32" href="#L32">32</a>          Assert.assertNotNull(formatHandler);
<a class="jxr_linenumber" name="L33" href="#L33">33</a>          Assert.assertTrue(formatHandler instanceof OdtFormatHandler);
<a class="jxr_linenumber" name="L34" href="#L34">34</a>          String content = formatHandler.extractContent(<span class="jxr_string">"eng"</span>, path);
<a class="jxr_linenumber" name="L35" href="#L35">35</a>          Assert.assertTrue(content.contains(<span class="jxr_string">"Lorem ipsum dolor sit amen."</span>));
<a class="jxr_linenumber" name="L36" href="#L36">36</a>      }
<a class="jxr_linenumber" name="L37" href="#L37">37</a>      
<a class="jxr_linenumber" name="L38" href="#L38">38</a>      @Test
<a class="jxr_linenumber" name="L39" href="#L39">39</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> extractContentOfficeDocumentTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L40" href="#L40">40</a>          Path path = Paths.get(getResource(FILE_DOCX).toURI());
<a class="jxr_linenumber" name="L41" href="#L41">41</a>          FormatHandler formatHandler = FormatHandlerUtil.find(MimeTypeUtil.guessMimeType(path, FILE_DOCX));
<a class="jxr_linenumber" name="L42" href="#L42">42</a>          Assert.assertNotNull(formatHandler);
<a class="jxr_linenumber" name="L43" href="#L43">43</a>          Assert.assertTrue(formatHandler instanceof DocxFormatHandler);
<a class="jxr_linenumber" name="L44" href="#L44">44</a>          String content = formatHandler.extractContent(<span class="jxr_string">"eng"</span>, path);
<a class="jxr_linenumber" name="L45" href="#L45">45</a>          Assert.assertTrue(content.contains(<span class="jxr_string">"Lorem ipsum dolor sit amen."</span>));
<a class="jxr_linenumber" name="L46" href="#L46">46</a>      }
<a class="jxr_linenumber" name="L47" href="#L47">47</a>  
<a class="jxr_linenumber" name="L48" href="#L48">48</a>      @Test
<a class="jxr_linenumber" name="L49" href="#L49">49</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> extractContentPowerpointTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L50" href="#L50">50</a>          Path path = Paths.get(getResource(FILE_PPTX).toURI());
<a class="jxr_linenumber" name="L51" href="#L51">51</a>          FormatHandler formatHandler = FormatHandlerUtil.find(MimeTypeUtil.guessMimeType(path, FILE_PPTX));
<a class="jxr_linenumber" name="L52" href="#L52">52</a>          Assert.assertNotNull(formatHandler);
<a class="jxr_linenumber" name="L53" href="#L53">53</a>          Assert.assertTrue(formatHandler instanceof PptxFormatHandler);
<a class="jxr_linenumber" name="L54" href="#L54">54</a>          String content = formatHandler.extractContent(<span class="jxr_string">"eng"</span>, path);
<a class="jxr_linenumber" name="L55" href="#L55">55</a>          Assert.assertTrue(content.contains(<span class="jxr_string">"Scaling"</span>));
<a class="jxr_linenumber" name="L56" href="#L56">56</a>      }
<a class="jxr_linenumber" name="L57" href="#L57">57</a>  
<a class="jxr_linenumber" name="L58" href="#L58">58</a>      @Test
<a class="jxr_linenumber" name="L59" href="#L59">59</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> extractContentPdf() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L60" href="#L60">60</a>          Path path = Paths.get(getResource(FILE_PDF).toURI());
<a class="jxr_linenumber" name="L61" href="#L61">61</a>          FormatHandler formatHandler = FormatHandlerUtil.find(MimeTypeUtil.guessMimeType(path, FILE_PDF));
<a class="jxr_linenumber" name="L62" href="#L62">62</a>          Assert.assertNotNull(formatHandler);
<a class="jxr_linenumber" name="L63" href="#L63">63</a>          Assert.assertTrue(formatHandler instanceof PdfFormatHandler);
<a class="jxr_linenumber" name="L64" href="#L64">64</a>          String content = formatHandler.extractContent(<span class="jxr_string">"eng"</span>, path);
<a class="jxr_linenumber" name="L65" href="#L65">65</a>          Assert.assertTrue(content.contains(<span class="jxr_string">"All human beings are born free and equal in dignity and rights."</span>));
<a class="jxr_linenumber" name="L66" href="#L66">66</a>      }
<a class="jxr_linenumber" name="L67" href="#L67">67</a>  
<a class="jxr_linenumber" name="L68" href="#L68">68</a>      @Test
<a class="jxr_linenumber" name="L69" href="#L69">69</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> extractContentScannedPdf() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L70" href="#L70">70</a>          Path path = Paths.get(getResource(<span class="jxr_string">"scanned.pdf"</span>).toURI());
<a class="jxr_linenumber" name="L71" href="#L71">71</a>          FormatHandler formatHandler = FormatHandlerUtil.find(MimeTypeUtil.guessMimeType(path, FILE_PDF_SCANNED));
<a class="jxr_linenumber" name="L72" href="#L72">72</a>          Assert.assertNotNull(formatHandler);
<a class="jxr_linenumber" name="L73" href="#L73">73</a>          Assert.assertTrue(formatHandler instanceof PdfFormatHandler);
<a class="jxr_linenumber" name="L74" href="#L74">74</a>          String content = formatHandler.extractContent(<span class="jxr_string">"eng"</span>, path);
<a class="jxr_linenumber" name="L75" href="#L75">75</a>          Assert.assertTrue(content.contains(<span class="jxr_string">"All human beings are born free and equal in dignity and rights."</span>));
<a class="jxr_linenumber" name="L76" href="#L76">76</a>      }
<a class="jxr_linenumber" name="L77" href="#L77">77</a>  
<a class="jxr_linenumber" name="L78" href="#L78">78</a>      @Test
<a class="jxr_linenumber" name="L79" href="#L79">79</a>      <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> convertToPdfTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L80" href="#L80">80</a>          <strong class="jxr_keyword">try</strong> (InputStream inputStream0 = getSystemResourceAsStream(FILE_JPG2);
<a class="jxr_linenumber" name="L81" href="#L81">81</a>                  InputStream inputStream1 = getSystemResourceAsStream(FILE_JPG);
<a class="jxr_linenumber" name="L82" href="#L82">82</a>                  InputStream inputStream2 = getSystemResourceAsStream(FILE_PDF_ENCRYPTED);
<a class="jxr_linenumber" name="L83" href="#L83">83</a>                  InputStream inputStream3 = getSystemResourceAsStream(FILE_DOCX);
<a class="jxr_linenumber" name="L84" href="#L84">84</a>                  InputStream inputStream4 = getSystemResourceAsStream(FILE_ODT);
<a class="jxr_linenumber" name="L85" href="#L85">85</a>                  InputStream inputStream5 = getSystemResourceAsStream(FILE_PPTX)) {
<a class="jxr_linenumber" name="L86" href="#L86">86</a>              <em class="jxr_comment">// Document</em>
<a class="jxr_linenumber" name="L87" href="#L87">87</a>              DocumentDto documentDto = <strong class="jxr_keyword">new</strong> DocumentDto();
<a class="jxr_linenumber" name="L88" href="#L88">88</a>              documentDto.setTitle(<span class="jxr_string">"My super document 1"</span>);
<a class="jxr_linenumber" name="L89" href="#L89">89</a>              documentDto.setDescription(<span class="jxr_string">"Lorem ipsum dolor sit amet, consectetur adipiscing elit.\r\n Duis id turpis iaculis, commodo est ac, efficitur quam.\t Nam accumsan magna in orci vulputate ultricies. Sed vulputate neque magna, at laoreet leo ultricies vel. Proin eu hendrerit felis. Quisque sit amet arcu efficitur, pulvinar orci sed, imperdiet elit. Nunc posuere ex sed fermentum congue. Aliquam ultrices convallis finibus. Praesent iaculis justo vitae dictum auctor. Praesent suscipit imperdiet erat ac maximus. Aenean pharetra quam sed fermentum commodo. Donec sagittis ipsum nibh, id congue dolor venenatis quis. In tincidunt nisl non ex sollicitudin, a imperdiet neque scelerisque. Nullam lacinia ac orci sed faucibus. Donec tincidunt venenatis justo, nec fermentum justo rutrum a."</span>);
<a class="jxr_linenumber" name="L90" href="#L90">90</a>              documentDto.setSubject(<span class="jxr_string">"A set of random picture"</span>);
<a class="jxr_linenumber" name="L91" href="#L91">91</a>              documentDto.setIdentifier(<span class="jxr_string">"ID-2016-08-00001"</span>);
<a class="jxr_linenumber" name="L92" href="#L92">92</a>              documentDto.setPublisher(<span class="jxr_string">"My Publisher, Inc."</span>);
<a class="jxr_linenumber" name="L93" href="#L93">93</a>              documentDto.setFormat(<span class="jxr_string">"A4 standard ISO format"</span>);
<a class="jxr_linenumber" name="L94" href="#L94">94</a>              documentDto.setType(<span class="jxr_string">"Image"</span>);
<a class="jxr_linenumber" name="L95" href="#L95">95</a>              documentDto.setCoverage(<span class="jxr_string">"France"</span>);
<a class="jxr_linenumber" name="L96" href="#L96">96</a>              documentDto.setRights(<span class="jxr_string">"Public Domain"</span>);
<a class="jxr_linenumber" name="L97" href="#L97">97</a>              documentDto.setLanguage(<span class="jxr_string">"en"</span>);
<a class="jxr_linenumber" name="L98" href="#L98">98</a>              documentDto.setCreator(<span class="jxr_string">"user1"</span>);
<a class="jxr_linenumber" name="L99" href="#L99">99</a>              documentDto.setCreateTimestamp(<strong class="jxr_keyword">new</strong> Date().getTime());
<a class="jxr_linenumber" name="L100" href="#L100">100</a>             
<a class="jxr_linenumber" name="L101" href="#L101">101</a>             <em class="jxr_comment">// First file</em>
<a class="jxr_linenumber" name="L102" href="#L102">102</a>             Files.copy(inputStream0, DirectoryUtil.getStorageDirectory().resolve(<span class="jxr_string">"apollo_landscape"</span>), StandardCopyOption.REPLACE_EXISTING);
<a class="jxr_linenumber" name="L103" href="#L103">103</a>             File file0 = <strong class="jxr_keyword">new</strong> File();
<a class="jxr_linenumber" name="L104" href="#L104">104</a>             file0.setId(<span class="jxr_string">"apollo_landscape"</span>);
<a class="jxr_linenumber" name="L105" href="#L105">105</a>             file0.setMimeType(MimeType.IMAGE_JPEG);
<a class="jxr_linenumber" name="L106" href="#L106">106</a>             
<a class="jxr_linenumber" name="L107" href="#L107">107</a>             <em class="jxr_comment">// Second file</em>
<a class="jxr_linenumber" name="L108" href="#L108">108</a>             Files.copy(inputStream1, DirectoryUtil.getStorageDirectory().resolve(<span class="jxr_string">"apollo_portrait"</span>), StandardCopyOption.REPLACE_EXISTING);
<a class="jxr_linenumber" name="L109" href="#L109">109</a>             File file1 = <strong class="jxr_keyword">new</strong> File();
<a class="jxr_linenumber" name="L110" href="#L110">110</a>             file1.setId(<span class="jxr_string">"apollo_portrait"</span>);
<a class="jxr_linenumber" name="L111" href="#L111">111</a>             file1.setMimeType(MimeType.IMAGE_JPEG);
<a class="jxr_linenumber" name="L112" href="#L112">112</a>             
<a class="jxr_linenumber" name="L113" href="#L113">113</a>             <em class="jxr_comment">// Third file</em>
<a class="jxr_linenumber" name="L114" href="#L114">114</a>             Files.copy(inputStream2, DirectoryUtil.getStorageDirectory().resolve(<span class="jxr_string">"udhr"</span>), StandardCopyOption.REPLACE_EXISTING);
<a class="jxr_linenumber" name="L115" href="#L115">115</a>             File file2 = <strong class="jxr_keyword">new</strong> File();
<a class="jxr_linenumber" name="L116" href="#L116">116</a>             file2.setId(<span class="jxr_string">"udhr"</span>);
<a class="jxr_linenumber" name="L117" href="#L117">117</a>             file2.setPrivateKey(<span class="jxr_string">"OnceUponATime"</span>);
<a class="jxr_linenumber" name="L118" href="#L118">118</a>             file2.setMimeType(MimeType.APPLICATION_PDF);
<a class="jxr_linenumber" name="L119" href="#L119">119</a>             
<a class="jxr_linenumber" name="L120" href="#L120">120</a>             <em class="jxr_comment">// Fourth file</em>
<a class="jxr_linenumber" name="L121" href="#L121">121</a>             Files.copy(inputStream3, DirectoryUtil.getStorageDirectory().resolve(<span class="jxr_string">"document_docx"</span>), StandardCopyOption.REPLACE_EXISTING);
<a class="jxr_linenumber" name="L122" href="#L122">122</a>             File file3 = <strong class="jxr_keyword">new</strong> File();
<a class="jxr_linenumber" name="L123" href="#L123">123</a>             file3.setId(<span class="jxr_string">"document_docx"</span>);
<a class="jxr_linenumber" name="L124" href="#L124">124</a>             file3.setMimeType(MimeType.OFFICE_DOCUMENT);
<a class="jxr_linenumber" name="L125" href="#L125">125</a>             
<a class="jxr_linenumber" name="L126" href="#L126">126</a>             <em class="jxr_comment">// Fifth file</em>
<a class="jxr_linenumber" name="L127" href="#L127">127</a>             Files.copy(inputStream4, DirectoryUtil.getStorageDirectory().resolve(<span class="jxr_string">"document_odt"</span>), StandardCopyOption.REPLACE_EXISTING);
<a class="jxr_linenumber" name="L128" href="#L128">128</a>             File file4 = <strong class="jxr_keyword">new</strong> File();
<a class="jxr_linenumber" name="L129" href="#L129">129</a>             file4.setId(<span class="jxr_string">"document_odt"</span>);
<a class="jxr_linenumber" name="L130" href="#L130">130</a>             file4.setMimeType(MimeType.OPEN_DOCUMENT_TEXT);
<a class="jxr_linenumber" name="L131" href="#L131">131</a> 
<a class="jxr_linenumber" name="L132" href="#L132">132</a>             <em class="jxr_comment">// Sixth file</em>
<a class="jxr_linenumber" name="L133" href="#L133">133</a>             Files.copy(inputStream5, DirectoryUtil.getStorageDirectory().resolve(<span class="jxr_string">"document_pptx"</span>), StandardCopyOption.REPLACE_EXISTING);
<a class="jxr_linenumber" name="L134" href="#L134">134</a>             File file5 = <strong class="jxr_keyword">new</strong> File();
<a class="jxr_linenumber" name="L135" href="#L135">135</a>             file5.setId(<span class="jxr_string">"document_pptx"</span>);
<a class="jxr_linenumber" name="L136" href="#L136">136</a>             file5.setMimeType(MimeType.OFFICE_PRESENTATION);
<a class="jxr_linenumber" name="L137" href="#L137">137</a> 
<a class="jxr_linenumber" name="L138" href="#L138">138</a>             ByteArrayOutputStream outputStream = <strong class="jxr_keyword">new</strong> ByteArrayOutputStream();
<a class="jxr_linenumber" name="L139" href="#L139">139</a>             PdfUtil.convertToPdf(documentDto, Lists.newArrayList(file0, file1, file2, file3, file4, file5), <strong class="jxr_keyword">true</strong>, <strong class="jxr_keyword">true</strong>, 10, outputStream);
<a class="jxr_linenumber" name="L140" href="#L140">140</a>             Assert.assertTrue(outputStream.toByteArray().length &gt; 0);
<a class="jxr_linenumber" name="L141" href="#L141">141</a>         }
<a class="jxr_linenumber" name="L142" href="#L142">142</a>     }
<a class="jxr_linenumber" name="L143" href="#L143">143</a> }
</pre>
<hr/>
<div id="footer">Copyright &#169; 2025. All rights reserved.</div>
</body>
</html>
